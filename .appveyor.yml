version: '{build}'

image: Visual Studio 2019

# Disable automatic builds
build: off

environment:
  CHERE_INVOKING: 1
  matrix:
    -MSYSTEM: MINGW64

# Build artifacts: all wheel and exe files in the dist folder
artifacts:
  - path: 'dist\*.whl'
  - path: 'dist\*.exe'

install:
- ps: |
    C:\msys64\usr\bin\bash -lc "cd /c/projects/borg"
    C:\msys64\usr\bin\bash -lc "pwd"
    C:\msys64\usr\bin\bash -lc "ls -la"
#    C:\msys64\usr\bin\bash -lc "pacman --noconfirm -Syuu"
#    C:\msys64\usr\bin\bash -lc "pacman --noconfirm -Syuu"
#    C:\msys64\usr\bin\bash -lc "pacman --noconfirm -S mingw-w64-x86_64-python3 git mingw-w64-x86_64-lz4 mingw-w64-x86_64-python3-pip mingw-w64-x86_64-cython mingw-w64-x86_64-gcc mingw-w64-x86_64-ntldd-git mingw-w64-x86_64-pkg-config mingw-w64-x86_64-openssl openssl-devel"
#    C:\msys64\usr\bin\bash -lc "pip install -r /c/projects/borg/requirements.d/development.txt"
#    C:\msys64\usr\bin\bash -lc "pip install wheel pyinstaller"

# build_script:
# - ps: |
#     $env:CHERE_INVOKING = 'yes'
#     $env:MSYSTEM = 'MINGW64'
#     C:\msys64\usr\bin\bash -lc "cd /c/projects/borg"
#     C:\msys64\usr\bin\bash -lc "./scripts/win-build.sh"
